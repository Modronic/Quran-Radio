<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" href="image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Û</text></svg>">
    <link rel="apple-touch-icon" href="image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Û</text></svg>">
    <title>Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… | Holy Quran Radio</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; }
        
        body {
            background: radial-gradient(circle at center, #0a0e17 0%, #020408 100%);
            color: #e2e8f0;
            font-family: 'Tajawal', sans-serif;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(rgba(212, 175, 55, 0.03) 1px, transparent 1px),
                radial-gradient(rgba(212, 175, 55, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            z-index: 0;
            pointer-events: none;
        }

        .app-container {
            position: relative;
            z-index: 10;
            width: 95%;
            max-width: 500px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.25);
            border-radius: 28px;
            padding: 45px 35px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 40px rgba(212, 175, 55, 0.15);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .app-container.playing {
            border-color: rgba(212, 175, 55, 0.6);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), 0 0 50px rgba(212, 175, 55, 0.35);
        }

        .warning-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 14px 20px;
            text-align: center;
            z-index: 1000;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.9rem;
            line-height: 1.5;
            display: none;
            animation: slideDown 0.4s ease;
        }

        .warning-banner.show { display: block; }
        .warning-banner.facebook { background: rgba(239, 68, 68, 0.95); color: white; }
        .warning-banner.adblock { background: rgba(245, 158, 11, 0.95); color: #000; }
        .warning-banner.network { background: rgba(59, 130, 246, 0.95); color: white; }
        .warning-banner strong { display: block; margin-bottom: 4px; font-weight: 700; }
        .warning-banner a { color: inherit; text-decoration: underline; font-weight: 600; }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .symbol-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto 35px;
            cursor: pointer;
            transition: transform 0.4s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .symbol-container:active { transform: scale(0.95); }
        .symbol-container:hover:not(:active) { transform: scale(1.05); }

        .symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .circle {
            position: absolute;
            border: 2px solid rgba(212, 175, 55, 0.7);
            border-radius: 50%;
            transition: all 0.6s ease;
        }

        .circle-1 { width: 100%; height: 100%; }
        .circle-2 { width: 85%; height: 85%; }
        .circle-3 { width: 70%; height: 70%; }

        .symbol-core {
            font-size: 52px;
            color: #D4AF37;
            transition: all 0.5s ease;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
            pointer-events: none;
        }

        .app-container.playing .circle { animation: pulse 3s infinite ease-in-out; }
        .app-container.playing .circle-1 { animation-delay: 0s; }
        .app-container.playing .circle-2 { animation-delay: 0.3s; }
        .app-container.playing .circle-3 { animation-delay: 0.6s; }

        .app-container.playing .symbol-core {
            animation: breathe 4s infinite ease-in-out;
            color: #f8f4e6;
            text-shadow: 0 0 25px rgba(255, 244, 220, 0.8);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.08); opacity: 1; }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .title {
            font-family: 'Amiri', serif;
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, #D4AF37, #f3cf55, #D4AF37);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 12px;
            letter-spacing: 1px;
            line-height: 1.3;
        }

        .subtitle {
            font-family: 'Tajawal', sans-serif;
            font-weight: 300;
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 35px;
            letter-spacing: 0.5px;
        }

        .status {
            min-height: 28px;
            font-size: 1.05rem;
            font-family: 'Amiri', serif;
            margin: 25px 0 25px;
            padding: 8px 20px;
            border-radius: 20px;
            background: rgba(30, 41, 59, 0.7);
            transition: opacity 0.4s ease, transform 0.4s ease;
            opacity: 1;
            transform: translateY(0);
        }

        .status.fade-out { opacity: 0; transform: translateY(-10px); }
        .status.idle { color: rgba(255, 255, 255, 0.6); border: 1px dashed rgba(212, 175, 55, 0.3); }
        .status.playing {
            color: #D4AF37;
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid rgba(212, 175, 55, 0.4);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }

        .status.error {
            color: #f87171;
            background: rgba(127, 29, 29, 0.2);
            border: 1px solid rgba(248, 113, 113, 0.4);
        }

        .status.info {
            color: #38bdf8;
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
        }

        .status.reconnecting {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.4);
        }

        .instructions {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 20px;
            line-height: 1.6;
            font-style: italic;
            padding: 15px;
            border-radius: 16px;
            background: rgba(0, 0, 0, 0.25);
        }

        .footer {
            margin-top: 25px;
            font-size: 0.8rem;
            color: rgba(212, 175, 55, 0.7);
            font-family: 'Tajawal', sans-serif;
            letter-spacing: 1px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .broadcast-status {
            margin-top: 8px;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.4);
            font-family: 'Tajawal', sans-serif;
            letter-spacing: 0.5px;
        }

        .broadcast-status.active { color: rgba(212, 175, 55, 0.8); }

        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            gap: 10px;
        }

        .control-btn {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(212, 175, 55, 0.4);
            color: #D4AF37;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            -webkit-tap-highlight-color: transparent;
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        .control-btn:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: scale(1.1);
            border-color: rgba(212, 175, 55, 0.7);
        }

        .control-btn:active { transform: scale(0.95); }

        .control-btn.stop {
            background: rgba(153, 27, 27, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        .control-btn.stop:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.7);
        }

        .control-btn:disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 30px;
            width: 100%;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .volume-icon {
            color: #D4AF37;
            font-size: 1.4rem;
            min-width: 28px;
            text-align: center;
        }

        .volume-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #D4AF37;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
            transition: all 0.2s ease;
        }

        .volume-slider::-webkit-slider-thumb:hover { transform: scale(1.25); background: #f3cf55; }
        .volume-slider::-webkit-slider-thumb:active { transform: scale(1.3); }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #D4AF37;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.4);
            color: #D4AF37;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: scale(1.05);
        }

        .action-btn:active { transform: scale(0.95); }

        .action-btn.update-available {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.6);
            color: #22c55e;
            animation: pulse-update 2s infinite;
        }

        @keyframes pulse-update {
            0%, 100% { box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
            50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .prayer-times {
            margin-top: 15px;
            font-size: 0.85rem;
            color: rgba(212, 175, 55, 0.7);
            font-family: 'Tajawal', sans-serif;
        }

        .sleep-timer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .sleep-timer-modal.show { display: flex; }

        .sleep-timer-content {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(212, 175, 55, 0.4);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 320px;
        }

        .sleep-timer-content h3 {
            color: #D4AF37;
            margin-bottom: 20px;
            font-family: 'Amiri', serif;
        }

        .sleep-timer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sleep-timer-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.4);
            color: #D4AF37;
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .sleep-timer-btn:hover {
            background: rgba(212, 175, 55, 0.15);
            transform: scale(1.05);
        }

        .sleep-timer-btn.close {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            color: #ef4444;
        }

        .utility-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 25px;
        }

        .utility-btn {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: rgba(212, 175, 55, 0.7);
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem; /* -1 font size as requested */
            font-family: 'Tajawal', sans-serif;
            transition: all 0.3s ease;
        }

        .utility-btn:hover {
            background: rgba(212, 175, 55, 0.1);
            color: rgba(212, 175, 55, 0.9);
        }

        .utility-btn.sleep-active {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.6);
            color: #f59e0b;
            animation: pulse-sleep 2s infinite;
        }

        @keyframes pulse-sleep {
            0%, 100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); }
        }

        .compat-info {
            margin-top: 15px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
            font-family: 'Tajawal', sans-serif;
            line-height: 1.4;
        }

        @media (max-width: 500px) {
            .app-container { padding: 35px 25px; border-radius: 24px; }
            .symbol-container { width: 150px; height: 150px; }
            .symbol-core { font-size: 44px; }
            .title { font-size: 2.3rem; }
            .subtitle { font-size: 1.1rem; }
            .control-btn { width: 65px; height: 65px; font-size: 1.6rem; }
            .volume-container { gap: 8px; }
            .volume-icon { font-size: 1.2rem; }
            .broadcast-status { font-size: 0.6rem; }
            .warning-banner { padding: 12px 15px; font-size: 0.85rem; }
            .compat-info { font-size: 0.65rem; }
            .action-buttons { gap: 10px; }
            .action-btn { padding: 8px 15px; font-size: 0.85rem; }
            .utility-buttons { gap: 10px; }
            .utility-btn { padding: 6px 12px; font-size: 0.75rem; }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            border-top-color: #D4AF37;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <!-- Warning Banners -->
    <div class="warning-banner facebook" id="facebookWarning">
        <strong>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠØ³Ø¨ÙˆÙƒ</strong>
        Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚ ÙÙŠØ³Ø¨ÙˆÙƒ.<br>
        <strong>Ø§Ù„Ø­Ù„:</strong> Ø§Ø¶ØºØ· â‹® Ø«Ù… "ÙØªØ­ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­" Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… <strong>Chrome/Safari</strong>
    </div>
    <div class="warning-banner adblock" id="adblockWarning">
        <strong>âš ï¸ ÙƒØ§Ø´Ù Ø­Ø¸Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong>
        ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø­Ø¸Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.<br>
        Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø«. ÙŠØ±Ø¬Ù‰ ØªØ¹Ø·ÙŠÙ„Ù‡ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.
    </div>
    <div class="warning-banner network" id="networkWarning">
        <strong>âš ï¸ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©</strong>
        Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¶Ø¹ÙŠÙ Ø£Ùˆ Ù…Ø­Ø¸ÙˆØ±.<br>
        Ø¬Ø±Ø¨ Ø´Ø¨ÙƒØ© Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©.
    </div>

    <div class="app-container" id="app">
        <div class="symbol-container" id="playButton">
            <div class="symbol">
                <div class="circle circle-1"></div>
                <div class="circle circle-2"></div>
                <div class="circle circle-3"></div>
                <div class="symbol-core">Û</div>
            </div>
        </div>
        
        <h1 class="title">Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
        <h2 class="subtitle">Ù…Ù† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© â€¢ Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</h2>
        
        <div class="status idle" id="status">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø² Û Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div>
        
        <div class="controls-container">
            <div class="control-btn" id="toggleBtn">â–¶</div>
        </div>
        
        <div class="volume-container">
            <div class="volume-icon" id="volumeIcon">ğŸ”‰</div>
            <input type="range" min="0" max="1" step="0.01" value="0.85" class="volume-slider" id="volumeSlider">
        </div>
        
        <div class="action-buttons">
            <button class="action-btn" id="shareBtn">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
            <button class="action-btn" id="sleepTimerBtn">â° Ù…Ø¤Ù‚Øª</button>
            <button class="action-btn" id="installBtn" style="display:none;">ğŸ“± ØªØ«Ø¨ÙŠØª</button>
            <button class="action-btn" id="updateBtn" style="display:none;">ğŸ”„ Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
        </div>
        
        <div class="prayer-times" id="prayerTimes">
            Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...
        </div>
        
        <div class="instructions">
            "ÙˆÙØ¥ÙØ°ÙØ§ Ù‚ÙØ±ÙØ¦Ù Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¢Ù†Ù ÙÙØ§Ø³Ù’ØªÙÙ…ÙØ¹ÙÙˆØ§ Ù„ÙÙ‡Ù ÙˆÙØ£ÙÙ†Ù’ØµÙØªÙÙˆØ§ Ù„ÙØ¹ÙÙ„ÙÙ‘ÙƒÙÙ…Ù’ ØªÙØ±Ù’Ø­ÙÙ…ÙÙˆÙ†Ù"
            <br><span style="font-size:0.9em; display:block; margin-top:8px;">Ø³ÙˆØ±Ø© Ø§Ù„Ø£Ø¹Ø±Ø§ÙØŒ Ø§Ù„Ø¢ÙŠØ© Ù¢Ù Ù¤</span>
        </div>
        
        <div class="footer">
            Holy Quran Radio â€¢ Cairo, Egypt
            <div class="broadcast-status" id="broadcastStatus">Ø¨Ø«: Ø¬Ø§Ù‡Ø²</div>
        </div>

        <div class="compat-info">
            ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰: Chrome, Firefox, Safari, Edge, Samsung Internet<br>
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø«Ù„ ÙÙŠØ³Ø¨ÙˆÙƒØŒ Ø¥Ù†Ø³ØªØºØ±Ø§Ù…ØŒ ØªÙˆÙŠØªØ±
        </div>

        <!-- Utility Buttons -->
        <div class="utility-buttons">
            <button class="utility-btn" id="sleepToggleBtn">â° ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª</button>
            <button class="utility-btn" id="refreshBtn">âŸ³ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©</button>
        </div>
    </div>

    <!-- Sleep Timer Modal -->
    <div class="sleep-timer-modal" id="sleepTimerModal">
        <div class="sleep-timer-content">
            <h3>â° Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…</h3>
            <div class="sleep-timer-options">
                <button class="sleep-timer-btn" data-minutes="15">Ù¡Ù¥ Ø¯Ù‚ÙŠÙ‚Ø©</button>
                <button class="sleep-timer-btn" data-minutes="30">Ù£Ù  Ø¯Ù‚ÙŠÙ‚Ø©</button>
                <button class="sleep-timer-btn" data-minutes="60">Ù¦Ù  Ø¯Ù‚ÙŠÙ‚Ø©</button>
                <button class="sleep-timer-btn close">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”´ YOUR ACTUAL STREAM URLS - PRESERVED EXACTLY AS REQUESTED ğŸ”´
        const STREAM_URLS = [
            "https://stream.radiojar.com/8s5u5tpdtwzuv",   // Server 1 - Primary
            "https://n03.radiojar.com/8s5u5tpdtwzuv",    // Server 2 - Backup
            "http://n0e.radiojar.com/8s5u5tpdtwzuv"     // Server 3 - Backup
        ];

        // ğŸ”§ Configuration
        const DEBUG = false;
        const STREAM_TIMEOUT_MS = 3000;
        const RECONNECT_LOOP_MS = 5000;
        const DEFAULT_VOLUME = 0.85;
        const APP_VERSION = '2.7.0';
        const CLICK_DEBOUNCE_MS = 300;

        // State Management
        let audio = null;
        let audioContext = null;
        let isPlaying = false;
        let currentServerIndex = 0;
        let reconnectAttempts = 0;
        let maxReconnectAttempts = 3;
        let isSwitchingServer = false;
        let lastErrorTime = 0;
        let errorTimeout = null;
        let stallTimeout = null;
        let isInitializing = false;
        let lastClickTime = 0;
        let lastShareClickTime = 0;
        let hasAttemptedPlay = false;
        let userPausedIntentionally = false;
        let reconnectLoopTimer = null;
        let sleepTimerTimeout = null;
        let sleepTimerInterval = null;
        let currentSleepTimerMinutes = 0;
        let isSleepTimerActive = false;
        let deferredPrompt = null;
        let isPWAInstalled = false;
        let isOnline = navigator.onLine;

        // DOM Elements
        const app = document.getElementById('app');
        const playButton = document.getElementById('playButton');
        const toggleBtn = document.getElementById('toggleBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeIcon = document.getElementById('volumeIcon');
        const statusEl = document.getElementById('status');
        const broadcastStatus = document.getElementById('broadcastStatus');
        const facebookWarning = document.getElementById('facebookWarning');
        const adblockWarning = document.getElementById('adblockWarning');
        const networkWarning = document.getElementById('networkWarning');
        const shareBtn = document.getElementById('shareBtn');
        const sleepTimerBtn = document.getElementById('sleepTimerBtn');
        const installBtn = document.getElementById('installBtn');
        const updateBtn = document.getElementById('updateBtn');
        const prayerTimes = document.getElementById('prayerTimes');
        const sleepTimerModal = document.getElementById('sleepTimerModal');
        const sleepToggleBtn = document.getElementById('sleepToggleBtn');
        const refreshBtn = document.getElementById('refreshBtn');

        // Browser Detection
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        const isHTTPS = window.location.protocol === 'https:';

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            const savedVolume = loadSavedVolume();
            volumeSlider.value = savedVolume;
            updateVolumeIcon(savedVolume);
            
            detectEnvironment();
            checkAdblock();
            setupAudioContext();
            setupPreload();
            setupNetworkMonitoring();
            setupPWA();
            checkForUpdates();
            loadCairoPrayerTimes();
            
            if (isIOS) {
                volumeSlider.disabled = true;
                volumeIcon.textContent = 'ğŸ“±';
                volumeSlider.style.opacity = '0.5';
            }
            
            logDebug("App initialized v" + APP_VERSION);
            startReconnectLoop();
        });

        // Prayer Times for Cairo
        async function loadCairoPrayerTimes() {
            try {
                const date = new Date();
                const response = await fetch(
                    `https://api.aladhan.com/v1/timingsByCity/${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}?city=Cairo&country=Egypt&method=5`
                );
                const data = await response.json();
                
                if (data.code === 200) {
                    const timings = data.data.timings;
                    const nextPrayer = getNextPrayer(timings);
                    prayerTimes.textContent = `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${nextPrayer}`;
                } else {
                    prayerTimes.textContent = "Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ØºÙŠØ± Ù…ØªØ§Ø­";
                }
            } catch (e) {
                logDebug("Prayer times error:", e);
                prayerTimes.textContent = "Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ØºÙŠØ± Ù…ØªØ§Ø­";
            }
        }

        function getNextPrayer(timings) {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            const prayers = [
                { name: 'Ø§Ù„ÙØ¬Ø±', time: timings.Fajr },
                { name: 'Ø§Ù„Ø¸Ù‡Ø±', time: timings.Dhuhr },
                { name: 'Ø§Ù„Ø¹ØµØ±', time: timings.Asr },
                { name: 'Ø§Ù„Ù…ØºØ±Ø¨', time: timings.Maghrib },
                { name: 'Ø§Ù„Ø¹Ø´Ø§Ø¡', time: timings.Isha }
            ];
            
            for (const prayer of prayers) {
                const [hours, minutes] = prayer.time.split(':').map(Number);
                const prayerMinutes = hours * 60 + minutes;
                if (prayerMinutes > currentMinutes) {
                    return prayer.name;
                }
            }
            
            return 'Ø§Ù„ÙØ¬Ø± (ØºØ¯Ù‹Ø§)';
        }

        // Network monitoring
        function setupNetworkMonitoring() {
            window.addEventListener('offline', () => {
                isOnline = false;
                logDebug("Network offline");
                if (isPlaying) {
                    networkWarning.classList.add('show');
                    updateStatus("Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª", "error", 3000);
                }
            });

            window.addEventListener('online', () => {
                isOnline = true;
                logDebug("Network online");
                networkWarning.classList.remove('show');
                
                // Auto-clear network banner after 5 seconds
                setTimeout(() => {
                    if (navigator.onLine) {
                        networkWarning.classList.remove('show');
                    }
                }, 5000);
                
                // Auto-reconnect if user had attempted play
                if (!isPlaying && hasAttemptedPlay && !userPausedIntentionally && !isSleepTimerActive) {
                    logDebug("Auto-reconnecting after network restore");
                    updateStatus("ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ - Ø¬Ø§Ø±Ù Ø§Ù„ØªØ´ØºÙŠÙ„...", "reconnecting", 2000);
                    setTimeout(() => {
                        if (navigator.onLine) {
                            startAudio();
                        }
                    }, 1000);
                }
            });
        }

        // Status with auto-clear
        function updateStatus(text, className, duration = 3000) {
            // Clear any existing status clearing timeouts
            if (window.statusClearTimeout) {
                clearTimeout(window.statusClearTimeout);
            }
            
            statusEl.classList.add('fade-out');
            setTimeout(() => {
                statusEl.textContent = text;
                statusEl.className = `status ${className}`;
                statusEl.classList.remove('fade-out');
                
                // Auto-clear status after specified duration (unless playing or sleep timer active)
                if (className !== 'playing' && className !== 'sleep-timer') {
                    window.statusClearTimeout = setTimeout(() => {
                        if (isPlaying) {
                            statusEl.textContent = "Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¬Ø§Ø±Ù Ø§Ù„Ø¢Ù†";
                            statusEl.className = "status playing";
                        } else {
                            statusEl.textContent = "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø² Û Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±";
                            statusEl.className = "status idle";
                        }
                    }, duration);
                }
            }, 400);
        }

        // Audio management
        function destroyAudio() {
            if (audio) {
                const events = ['playing', 'pause', 'ended', 'error', 'stalled', 'waiting', 'abort', 'suspend', 'timeupdate', 'seeking'];
                events.forEach(event => {
                    audio.removeEventListener(event, eventHandlers[event]);
                });

                try {
                    audio.pause();
                    audio.src = '';
                    audio.load();
                } catch (e) {
                    logDebug("Error during audio destroy:", e);
                }
                audio = null;
            }

            if (stallTimeout) { clearTimeout(stallTimeout); stallTimeout = null; }
        }

        function initAudio() {
            if (isInitializing) return;
            isInitializing = true;
            
            destroyAudio();
            
            audio = new Audio();
            audio.crossOrigin = "anonymous";
            audio.volume = 0.9; // 90% default volume
            
            if (isIOS) {
                audio.setAttribute('playsinline', '');
                audio.setAttribute('webkit-playsinline', '');
            }
            
            audio.setAttribute('controlsList', 'nodownload nofullscreen noremoteplayback');
            audio.setAttribute('disableRemotePlayback', '');
            audio.preload = "metadata";
            
            Object.entries(eventHandlers).forEach(([event, handler]) => {
                audio.addEventListener(event, handler);
            });
            
            isInitializing = false;
            logDebug("Audio initialized");
        }

        const eventHandlers = {
            playing: onPlaying,
            pause: onPause,
            ended: onEnded,
            error: onError,
            stalled: onStalled,
            waiting: onWaiting,
            abort: onAbort,
            suspend: onSuspend
        };

        // Event handlers
        function onPlaying() {
            isPlaying = true;
            reconnectAttempts = 0;
            isSwitchingServer = false;
            app.classList.add('playing');
            toggleBtn.innerHTML = 'â– ';
            toggleBtn.classList.add('stop');
            updateStatus("Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¬Ø§Ø±Ù Ø§Ù„Ø¢Ù†", "playing");
            updateBroadcastStatus();
            networkWarning.classList.remove('show');
            
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().catch(e => logDebug("AudioContext resume:", e));
            }
            
            logDebug(`Playing from Cairo server ${currentServerIndex + 1}`);
        }

        function onPause() {
            if (!isPlaying) return;
            isPlaying = false;
            app.classList.remove('playing');
            toggleBtn.innerHTML = 'â–¶';
            toggleBtn.classList.remove('stop');
            updateStatus("Ù…ÙÙˆÙ‚ÙÙ Ù…Ø¤Ù‚ØªÙ‹Ø§", "idle");
            logDebug("Audio paused");
        }

        function onEnded() {
            if (!isPlaying || isSwitchingServer) return;
            logDebug("Stream ended - trying next");
            tryNextStream();
        }

        function onError(e) {
            const now = Date.now();
            if (now - lastErrorTime < 2000) return;
            lastErrorTime = now;
            
            if (e.name !== 'AbortError') {
                logDebug("Stream error:", e);
            }
            if (!isSwitchingServer) {
                tryNextStream();
            }
        }

        function onStalled() {
            if (!isPlaying || isSwitchingServer) return;
            if (stallTimeout) clearTimeout(stallTimeout);
            stallTimeout = setTimeout(() => {
                logDebug("Stream stalled - trying next");
                tryNextStream();
            }, 3000);
        }

        function onWaiting() {
            if (!isPlaying || isSwitchingServer) return;
            updateStatus("Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...", "info", 1500);
        }

        function onAbort() {
            if (isSwitchingServer) return;
            logDebug("Stream aborted");
            tryNextStream();
        }

        function onSuspend() {
            if (isSwitchingServer) return;
            logDebug("Stream suspended");
            tryNextStream();
        }

        function onTimeUpdate() {
            if (audio && audio.duration > 0 && !audio.ended && isPlaying) {
                if (audio.currentTime < audio.duration - 10) {
                    try {
                        audio.currentTime = audio.duration - 1;
                    } catch (e) {
                        // Ignore seek errors
                    }
                }
            }
        }

        function onSeeking(e) {
            if (isPlaying) {
                e.preventDefault();
                setTimeout(() => {
                    if (audio && audio.duration > 0) {
                        try {
                            audio.currentTime = audio.duration - 1;
                        } catch (e) {
                            // Ignore seek errors
                        }
                    }
                }, 100);
            }
        }

        // Smart stream cycling
        function tryNextStream() {
            if (!isPlaying || isSwitchingServer) return;

            stopReconnectLoop();
            isSwitchingServer = true;
            updateStatus("Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨Ø« Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ...", "reconnecting", 2000);

            destroyAudio();
            initAudio();

            currentServerIndex = (currentServerIndex + 1) % STREAM_URLS.length;

            // If we've tried all servers and back to start
            if (currentServerIndex === 0 && currentServerIndex > 0) {
                stopAudio();
                updateStatus("Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø«ÙˆØµ ØºÙŠØ± Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.", "error", 4000);
                broadcastStatus.textContent = "Ø¨Ø«: ØºÙŠØ± Ù…ØªØµÙ„";
                broadcastStatus.className = "broadcast-status";
                return;
            }

            audio.src = `${STREAM_URLS[currentServerIndex]}?t=${Date.now()}`;
            broadcastStatus.textContent = "Ø¨Ø«: Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...";

            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    isSwitchingServer = false;
                    if (error.name !== 'AbortError') {
                        logDebug(`Backup server ${currentServerIndex + 1} failed`);
                        setTimeout(() => tryNextStream(), STREAM_TIMEOUT_MS);
                    }
                });
            }
        }

        function startReconnectLoop() {
            if (reconnectLoopTimer) return;
            
            reconnectLoopTimer = setInterval(() => {
                if (hasAttemptedPlay && !isPlaying && !userPausedIntentionally && !isSleepTimerActive && navigator.onLine) {
                    logDebug("Reconnect loop: Attempting to connect...");
                    attemptConnect();
                }
            }, RECONNECT_LOOP_MS);
        }

        function stopReconnectLoop() {
            if (reconnectLoopTimer) {
                clearInterval(reconnectLoopTimer);
                reconnectLoopTimer = null;
            }
        }

        function attemptConnect() {
            if (isPlaying || isSwitchingServer || isInitializing) return;

            isSwitchingServer = true;
            updateStatus("Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...", "reconnecting", 2000);
            broadcastStatus.textContent = "Ø¨Ø«: Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...";

            initAudio();
            audio.src = `${STREAM_URLS[currentServerIndex]}?t=${Date.now()}`;

            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    isSwitchingServer = false;
                    if (error.name !== 'AbortError') {
                        logDebug("Connect failed, will retry...");
                    }
                });
            }
        }

        function updateBroadcastStatus() {
            broadcastStatus.textContent = `Ø¨Ø«: ${currentServerIndex + 1} Ù†Ø´Ø·`;
            broadcastStatus.className = "broadcast-status active";
        }

        // âœ… SLEEP TIMER (Surgical Fix: Toggle Button)
        function setSleepTimer(minutes) {
            // Clear existing timer
            if (sleepTimerTimeout) {
                clearTimeout(sleepTimerTimeout);
                sleepTimerTimeout = null;
            }
            if (sleepTimerInterval) {
                clearInterval(sleepTimerInterval);
                sleepTimerInterval = null;
            }

            currentSleepTimerMinutes = minutes;
            isSleepTimerActive = true;
            updateSleepTimerButton();

            // Update status with live countdown
            updateStatus(`â° Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…: ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`, "info");

            // Start countdown interval
            sleepTimerInterval = setInterval(() => {
                if (currentSleepTimerMinutes > 0) {
                    currentSleepTimerMinutes--;
                    const remainingMinutes = Math.floor(currentSleepTimerMinutes % 60);
                    const remainingHours = Math.floor(currentSleepTimerMinutes / 60);
                    
                    if (remainingHours > 0) {
                        updateStatus(`â° Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…: ${remainingHours}:${String(remainingMinutes).padStart(2, '0')}`, "info");
                    } else {
                        updateStatus(`â° Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…: ${remainingMinutes} Ø¯Ù‚ÙŠÙ‚Ø©`, "info");
                    }
                } else {
                    clearInterval(sleepTimerInterval);
                    if (isPlaying) {
                        stopAudio();
                        updateStatus("Ø§Ù†ØªÙ‡Ù‰ Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…", "idle", 2000);
                    }
                    clearSleepTimer();
                }
            }, 60000); // Update every minute

            // Set timeout for actual stop
            sleepTimerTimeout = setTimeout(() => {
                if (isPlaying) {
                    stopAudio();
                    updateStatus("Ø§Ù†ØªÙ‡Ù‰ Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…", "idle", 2000);
                }
                clearInterval(sleepTimerInterval);
                clearSleepTimer();
            }, minutes * 60 * 1000);
        }

        function clearSleepTimer() {
            if (sleepTimerTimeout) {
                clearTimeout(sleepTimerTimeout);
                sleepTimerTimeout = null;
            }
            if (sleepTimerInterval) {
                clearInterval(sleepTimerInterval);
                sleepTimerInterval = null;
            }

            currentSleepTimerMinutes = 0;
            isSleepTimerActive = false;
            updateSleepTimerButton();

            // Reset status if not playing
            if (!isPlaying) {
                updateStatus("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø² Û Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±", "idle");
            } else {
                updateStatus("Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¬Ø§Ø±Ù Ø§Ù„Ø¢Ù†", "playing");
            }
        }

        function updateSleepTimerButton() {
            if (isSleepTimerActive) {
                sleepToggleBtn.textContent = "â° Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ù‚Øª";
                sleepToggleBtn.classList.add('sleep-active');
            } else {
                sleepToggleBtn.textContent = "â° ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª";
                sleepToggleBtn.classList.remove('sleep-active');
            }
        }

        // âœ… SLEEP TIMER TOGGLE BUTTON (Single button for activate/deactivate)
        sleepToggleBtn.addEventListener('click', () => {
            if (!canPerformAction(lastClickTime)) return;
            lastClickTime = Date.now();

            if (isSleepTimerActive) {
                clearSleepTimer();
                updateStatus("ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ…", "info", 1500);
            } else {
                // Show modal to select duration
                sleepTimerModal.classList.add('show');
            }
        });

        // Sleep timer modal selection
        document.querySelectorAll('.sleep-timer-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (!canPerformAction(lastClickTime)) return;
                lastClickTime = Date.now();

                if (btn.classList.contains('close')) {
                    sleepTimerModal.classList.remove('show');
                    return;
                }

                const minutes = parseInt(btn.dataset.minutes);
                setSleepTimer(minutes);
                sleepTimerModal.classList.remove('show');
            });
        });

        // Close modal on outside click
        sleepTimerModal.addEventListener('click', (e) => {
            if (e.target === sleepTimerModal) {
                sleepTimerModal.classList.remove('show');
            }
        });

        // âœ… REFRESH BUTTON
        refreshBtn.addEventListener('click', () => {
            if (!canPerformAction(lastClickTime, 5000)) return;
            lastClickTime = Date.now();
            location.reload();
        });

        // Main controls
        function startAudio() {
            const now = Date.now();
            if (now - lastClickTime < CLICK_DEBOUNCE_MS) return;
            lastClickTime = now;

            hasAttemptedPlay = true;
            userPausedIntentionally = false;
            stopReconnectLoop();

            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().catch(e => logDebug("AudioContext resume failed:", e));
            }

            updateStatus("Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...", "idle", 2000);

            initAudio();
            audio.src = `${STREAM_URLS[currentServerIndex]}?t=${Date.now()}`;

            const playPromise = audio.play();

            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    if (error.name !== 'AbortError') {
                        logDebug("Initial connect failed, cycling streams...");
                        setTimeout(() => tryNextStream(), STREAM_TIMEOUT_MS);
                    }
                });
            }
        }

        function stopAudio() {
            const now = Date.now();
            if (now - lastClickTime < CLICK_DEBOUNCE_MS) return;
            lastClickTime = now;

            hasAttemptedPlay = false;
            userPausedIntentionally = true;
            stopReconnectLoop();

            if (sleepTimerTimeout) {
                clearTimeout(sleepTimerTimeout);
                sleepTimerTimeout = null;
            }
            if (sleepTimerInterval) {
                clearInterval(sleepTimerInterval);
                sleepTimerInterval = null;
            }

            if (errorTimeout) { clearTimeout(errorTimeout); errorTimeout = null; }
            if (stallTimeout) { clearTimeout(stallTimeout); stallTimeout = null; }

            destroyAudio();

            isPlaying = false;
            isSwitchingServer = false;
            isInitializing = false;
            lastErrorTime = 0;
            isSleepTimerActive = false; // âœ… Clear sleep timer state
            updateSleepTimerButton(); // âœ… Update button state

            app.classList.remove('playing');
            toggleBtn.innerHTML = 'â–¶';
            toggleBtn.classList.remove('stop');
            updateStatus("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«", "idle", 2000);
            broadcastStatus.textContent = "Ø¨Ø«: Ø¬Ø§Ù‡Ø²";
            broadcastStatus.className = "broadcast-status";
            networkWarning.classList.remove('show');

            logDebug("Audio stopped");
        }

        function handleToggleClick(e) {
            e.preventDefault();
            e.stopPropagation();

            if (toggleBtn.disabled) return;
            if (!canPerformAction(lastClickTime)) return;

            if (isPlaying) {
                stopAudio();
            } else {
                startAudio();
            }
        }

        // Event listeners
        toggleBtn.addEventListener('click', handleToggleClick);
        toggleBtn.addEventListener('touchstart', handleToggleClick);
        playButton.addEventListener('click', handleToggleClick);
        playButton.addEventListener('touchstart', handleToggleClick);

        // Share functionality
        shareBtn.addEventListener('click', async () => {
            if (!canPerformAction(lastShareClickTime, 2000)) return;
            lastShareClickTime = Date.now();

            if (navigator.share && isHTTPS) {
                try {
                    await navigator.share({
                        title: 'Ø¥Ø°Ø§Ø¹Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…',
                        text: 'Ø§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… Ù…Ù† Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©',
                        url: window.location.href
                    });
                } catch (e) {
                    logDebug("Share error:", e);
                    // Fallback to clipboard
                    navigator.clipboard.writeText(window.location.href);
                    updateStatus("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø­Ø§ÙØ¸Ø©", "info", 2000);
                }
            } else {
                navigator.clipboard.writeText(window.location.href);
                updateStatus("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø­Ø§ÙØ¸Ø©", "info", 2000);
            }
        });

        // Volume control
        volumeSlider.addEventListener('input', () => {
            const volume = parseFloat(volumeSlider.value);
            saveVolume(volume);

            if (audio && !isIOS) {
                audio.volume = volume;
            }

            updateVolumeIcon(volume);
        });

        volumeSlider.addEventListener('change', (e) => {
            if (isIOS) {
                e.target.value = loadSavedVolume();
            }
        });

        function updateVolumeIcon(volume) {
            if (isIOS) {
                volumeIcon.textContent = 'ğŸ“±';
                return;
            }

            if (volume === 0) {
                volumeIcon.textContent = 'ğŸ”‡';
            } else if (volume < 0.5) {
                volumeIcon.textContent = 'ğŸ”ˆ';
            } else {
                volumeIcon.textContent = 'ğŸ”Š';
            }
        }

        function loadSavedVolume() {
            try {
                const saved = localStorage.getItem('quranRadioVolume');
                return saved ? parseFloat(saved) : DEFAULT_VOLUME;
            } catch (e) {
                return DEFAULT_VOLUME;
            }
        }

        function saveVolume(volume) {
            try {
                localStorage.setItem('quranRadioVolume', volume.toString());
            } catch (e) {
                logDebug("Could not save volume:", e);
            }
        }

        function canPerformAction(lastTime, debounceMs = CLICK_DEBOUNCE_MS) {
            const now = Date.now();
            return (now - lastTime >= debounceMs);
        }

        function detectEnvironment() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const isInAppBrowser = (
                userAgent.includes('FBAN') || userAgent.includes('FBAV') ||
                userAgent.includes('FB_IAB') || userAgent.includes('FB4A') ||
                userAgent.includes('Instagram') || userAgent.includes('Twitter') ||
                userAgent.includes('LinkedIn') || userAgent.includes('Snapchat') ||
                userAgent.includes('TikTok') || /FBAV/.test(userAgent)
            );

            if (isInAppBrowser) {
                facebookWarning.classList.add('show');
                disableControls();
                updateStatus("Ø§ÙØªØ­ ÙÙŠ Ù…ØªØµÙØ­ Ù…Ù†ÙØµÙ„", "warning", 4000);
            }
        }

        function checkAdblock() {
            const test = document.createElement('div');
            test.innerHTML = '&nbsp;';
            test.className = 'adsbox';
            test.style.position = 'absolute';
            test.style.left = '-9999px';
            document.body.appendChild(test);

            setTimeout(() => {
                if (test.offsetHeight === 0 || test.clientHeight === 0 ||
                    window.getComputedStyle(test).display === 'none') {
                    adblockWarning.classList.add('show');
                }
                document.body.removeChild(test);
            }, 100);
        }

        function setupAudioContext() {
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                if (window.AudioContext) {
                    audioContext = new AudioContext();
                }
            } catch (e) {
                logDebug("Web Audio API not supported");
            }
        }

        function setupPreload() {
            STREAM_URLS.forEach(url => {
                try {
                    const link = document.createElement('link');
                    link.rel = 'preconnect';
                    link.href = new URL(url, window.location.href).origin;
                    document.head.appendChild(link);
                } catch (e) {
                    logDebug(`Invalid URL: ${url}`);
                }
            });
        }

        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                if (!isPWAInstalled) {
                    installBtn.style.display = 'flex';
                }
                logDebug("PWA install prompt ready");
            });

            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    logDebug(`PWA install outcome: ${outcome}`);
                    deferredPrompt = null;
                    installBtn.style.display = 'none';
                }
            });

            window.addEventListener('appinstalled', () => {
                logDebug("PWA installed successfully");
                isPWAInstalled = true;
                installBtn.style.display = 'none';
            });
        }

        function checkForUpdates() {
            const lastVersion = localStorage.getItem('quranRadioVersion');
            if (lastVersion && lastVersion !== APP_VERSION) {
                updateBtn.style.display = 'flex';
                updateBtn.classList.add('update-available');
                updateBtn.textContent = 'ğŸ”„ Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­';
                
                updateBtn.addEventListener('click', () => {
                    localStorage.setItem('quranRadioVersion', APP_VERSION);
                    updateBtn.style.display = 'none';
                    location.reload();
                });
            } else {
                updateBtn.style.display = 'none';
            }
            localStorage.setItem('quranRadioVersion', APP_VERSION);
        }

        function disableControls() {
            toggleBtn.disabled = true;
            toggleBtn.style.opacity = "0.5";
            toggleBtn.style.cursor = "not-allowed";
            toggleBtn.style.pointerEvents = "none";
            playButton.style.pointerEvents = "none";
            volumeSlider.disabled = true;
        }

        // Handle page visibility
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden' && isPlaying) {
                logDebug("Page hidden - audio continues in background");
            }
        });

        // Page unload cleanup
        window.addEventListener('beforeunload', () => {
            stopReconnectLoop();
            if (audio) {
                audio.pause();
                audio.src = '';
            }
        });

        function logDebug(message, ...args) {
            if (DEBUG) {
                console.log(`[DEBUG] ${message}`, ...args);
            }
        }

        // Initial status
        updateStatus("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù…Ø² Û Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±", "idle");
        broadcastStatus.textContent = "Ø¨Ø«: Ø¬Ø§Ù‡Ø²";
    </script>
</body>
</html>
